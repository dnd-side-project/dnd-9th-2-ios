//
//  AppFeature.swift
//  PromiseDemo
//
//  Created by youtak on 2023/07/19.
//

import ComposableArchitecture

struct AppFeature: ReducerProtocol {

    struct State: Equatable {
        var isLoggedIn: Bool

        // MARK: - Scope State

        var loginFeature: LoginFeature.State
        var mainTabFeature: MainTabFeature.State
    }

    enum Action: Equatable {

        // MARK: - Scope Action

        case login(LoginFeature.Action)
        case mainTab(MainTabFeature.Action)
    }

    var body: some ReducerProtocolOf<Self> {

        // MARK: - Scope

        Scope(state: \.loginFeature, action: /Action.login) {
            LoginFeature()
        }

        Scope(state: \.mainTabFeature, action: /Action.mainTab) {
            MainTabFeature()
        }

        // MARK: - Reduce

        Reduce { state, action in
            switch action {

            // Login Feature

            case .login(.delegate(.moveToMainTab)):
                state.isLoggedIn = true
                return .none

            case .login:
                return .none

            // MainTab Feature

            case .mainTab(.delegate(.moveToLogin)):
                state.isLoggedIn = false
                state.mainTabFeature = MainTabFeature.State(
                    selectedTab: .home,
                    homeFeature: HomeFeature.State(),
                    myPageFeature: MyPageFeature.State()
                )
                return .none

            case .mainTab:
                return .none
            }
        }
    }
}
